(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var metals = require("./metals");
function createMetalNumberInput(prefix, metal, metalPropertyName, additionalOnChange) {
    var input = document.createElement('input');
    input.value = metal.buffered_metal_concentration.toString();
    input.classList.add(prefix);
    input.id = prefix + '_' + metal.id_suffix;
    input.type = 'number';
    input.addEventListener('change', function (event) {
        var _a;
        var val = event.target.value;
        var floatVal = parseFloat(val); // TODO: validation!
        var m = metals.all_metals[metal.id_suffix];
        Object.assign(m, (_a = {}, _a[metalPropertyName] = floatVal, _a));
        if (additionalOnChange)
            additionalOnChange(metal.id_suffix);
    });
    return input;
}
function appendMetalTableRow(metal, table) {
    var row = table.insertRow(table.rows.length - 1);
    row.insertCell(-1).outerHTML = "<th>" + metal.symbol + "</th>";
    var affinity_cell = row.insertCell(-1);
    affinity_cell.classList.add('affinity');
    var affinity_input = createMetalNumberInput('affinity', metal, 'affinity', function (id) {
        var m = metals.all_metals[id];
        m.metalation_delta_G = m.calculateDeltaG(m.affinity);
        // FIXME: change this to be watched by Metal?
        document.getElementById("metalation_delta_g_" + id).innerText = m.metalation_delta_G.toFixed(1).toString();
    });
    affinity_cell.appendChild(affinity_input);
    var m_delta_g_cell = row.insertCell(-1);
    m_delta_g_cell.id = "metalation_delta_g_" + metal.id_suffix;
    m_delta_g_cell.innerText = metal.metalation_delta_G.toFixed(1).toString();
    var bmc_cell = row.insertCell(-1);
    bmc_cell.classList.add('bmc');
    var bmc_input = createMetalNumberInput('bmc', metal, 'buffered_metal_concentration', function (id) {
        var m = metals.all_metals[id];
        m.intracellular_available_delta_G = m.calculateDeltaG(m.buffered_metal_concentration);
        //FIXME: change this to be watched by Metal?
        document.getElementById("ia_delta_g_" + id).value = m.intracellular_available_delta_G.toString();
    });
    bmc_cell.appendChild(bmc_input);
    var ia_delta_g_cell = row.insertCell(-1);
    var ia_delta_g_input = createMetalNumberInput('ia_delta_g', metal, 'intracellular_available_delta_G', null);
    ia_delta_g_cell.appendChild(ia_delta_g_input);
    var result_cell = row.insertCell(-1);
    result_cell.id = "result_" + metal.id_suffix;
}
function calculate() {
    var results = metals.calculateOccupancy();
    for (var id in metals.all_metals) {
        var r = results[id];
        var result_cell = document.getElementById("result_" + id);
        result_cell.innerHTML = (r * 100).toFixed(2).toString() + '%';
    }
    var total_cell = document.getElementById("total_metalation");
    total_cell.innerHTML = (results['total'] * 100).toFixed(2).toString() + '%';
}
// Quick and simple export target #table_id into a csv
function downloadTableAsCsv(table_id, separator) {
    if (separator === void 0) { separator = ','; }
    // Select rows from table_id
    var rows = document.querySelectorAll('table#' + table_id + ' tr');
    // Construct csv
    var csv = [];
    for (var i = 0; i < rows.length; i++) {
        var row = [], cols = rows[i].querySelectorAll('td, th');
        for (var j = 0; j < cols.length; j++) {
            // Clean innertext to remove multiple spaces and jumpline (break csv)
            var data;
            var inputs = cols[j].getElementsByTagName('input');
            if (inputs.length > 0) {
                data = inputs[0].value;
            }
            else {
                data = cols[j].innerText;
            }
            // Remove line breaks and escape double-quote with double-double-quote
            data = data.replace(/(\r\n|\n|\r)/gm, '').replace(/(\s\s)/gm, ' ');
            data = data.replace(/"/g, '""');
            // Push escaped string
            row.push('"' + data + '"');
        }
        csv.push(row.join(separator));
    }
    var csv_string = csv.join('\n');
    // Download it
    var filename = 'export_' + table_id + '_' + new Date().toLocaleDateString() + '.csv';
    var link = document.createElement('a');
    link.style.display = 'none';
    link.setAttribute('target', '_blank');
    link.setAttribute('href', 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv_string));
    link.setAttribute('download', filename);
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}
window.addEventListener('DOMContentLoaded', function (event) {
    var metal_table = document.getElementById('metalation_table');
    for (var id in metals.all_metals) {
        var m = metals.all_metals[id];
        appendMetalTableRow(m, metal_table);
    }
    document.getElementById('calculate_btn').onclick = function () {
        calculate();
        document.getElementById('download_btn').disabled = false;
    };
    document.getElementById('download_btn').onclick = function () {
        downloadTableAsCsv('metalation_table');
    };
});

},{"./metals":2}],2:[function(require,module,exports){
"use strict";
var __spreadArray = (this && this.__spreadArray) || function (to, from) {
    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)
        to[j] = from[i];
    return to;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.calculateOccupancy = exports.all_metals = exports.Metal = void 0;
var Metal = /** @class */ (function () {
    function Metal(name, symbol, affinity, concentration) {
        this.name = name;
        this.symbol = symbol;
        this.affinity = affinity;
        this.metalation_delta_G = this.calculateDeltaG(affinity);
        this.buffered_metal_concentration = concentration;
        this.intracellular_available_delta_G = this.calculateDeltaG(concentration);
        this.id_suffix = symbol.toLowerCase();
    }
    Metal.prototype.calculateDeltaG = function (mole_value) {
        return 8.314 * 298.15 * Math.log(mole_value) / 1000;
    };
    return Metal;
}());
exports.Metal = Metal;
var metal_vals = [
    ["Magnesium", "Mg", 1E3, 2.7E-3],
    ["Manganese", "Mn", 1E3, 2.6E-6],
    ["Iron", "Fe", 1E-6, 4.8E-8],
    ["Cobalt", "Co", 3E-11, 2.5E-9],
    ["Nickel", "Ni", 9.8E-10, 1.8E-13],
    ["Copper", "Cu", 2.4E-16, 1.2E-18],
    ["Zinc", "Zn", 1.9E-13, 1.19E-12],
];
exports.all_metals = {};
for (var _i = 0, metal_vals_1 = metal_vals; _i < metal_vals_1.length; _i++) {
    var m = metal_vals_1[_i];
    exports.all_metals[m[1].toLowerCase()] = new (Metal.bind.apply(Metal, __spreadArray([void 0], m)))();
}
function calculateOccupancy() {
    var exp_scaled_differences = {};
    var total_diffs = 0;
    for (var id in exports.all_metals) {
        var m_1 = exports.all_metals[id];
        exp_scaled_differences[id] = Math.exp(1000 * (m_1.intracellular_available_delta_G - m_1.metalation_delta_G)
            / (8.314 * 298.15));
        total_diffs += exp_scaled_differences[id];
    }
    var occupancies = {};
    var total_occupancy = 0;
    for (var id in exports.all_metals) {
        occupancies[id] = exp_scaled_differences[id] / (1 + total_diffs);
        total_occupancy += occupancies[id];
    }
    occupancies['total'] = total_occupancy;
    return occupancies;
}
exports.calculateOccupancy = calculateOccupancy;

},{}]},{},[1,2])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvbWFpbi50cyIsInNyYy9tZXRhbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7OztBQ0FBLGlDQUFrQztBQUVsQyxTQUFTLHNCQUFzQixDQUFDLE1BQWUsRUFBRSxLQUFvQixFQUFFLGlCQUF5QixFQUFFLGtCQUF3QztJQUN4SSxJQUFNLEtBQUssR0FBcUIsUUFBUSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUNoRSxLQUFLLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQyw0QkFBNEIsQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUM1RCxLQUFLLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUM1QixLQUFLLENBQUMsRUFBRSxHQUFHLE1BQU0sR0FBRyxHQUFHLEdBQUcsS0FBSyxDQUFDLFNBQVMsQ0FBQztJQUMxQyxLQUFLLENBQUMsSUFBSSxHQUFHLFFBQVEsQ0FBQztJQUN0QixLQUFLLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxFQUFFLFVBQVMsS0FBSzs7UUFDN0MsSUFBTSxHQUFHLEdBQXNCLEtBQUssQ0FBQyxNQUFPLENBQUMsS0FBSyxDQUFDO1FBQ25ELElBQUksUUFBUSxHQUFHLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLG9CQUFvQjtRQUNwRCxJQUFNLENBQUMsR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUM3QyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsWUFBSSxHQUFDLGlCQUFpQixJQUFHLFFBQVEsTUFBRyxDQUFDO1FBQ3BELElBQUksa0JBQWtCO1lBQUUsa0JBQWtCLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQzlELENBQUMsQ0FBQyxDQUFDO0lBQ0gsT0FBTyxLQUFLLENBQUM7QUFDZixDQUFDO0FBRUQsU0FBUyxtQkFBbUIsQ0FBQyxL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b3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiaW1wb3J0ICogYXMgbWV0YWxzIGZyb20gXCIuL21ldGFsc1wiXG5cbmZ1bmN0aW9uIGNyZWF0ZU1ldGFsTnVtYmVySW5wdXQocHJlZml4IDogc3RyaW5nLCBtZXRhbCA6IG1ldGFscy5NZXRhbCwgbWV0YWxQcm9wZXJ0eU5hbWU6IHN0cmluZywgYWRkaXRpb25hbE9uQ2hhbmdlOiAoaWQ6IHN0cmluZykgPT4gdm9pZCkge1xuICBjb25zdCBpbnB1dCA9IDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gIGlucHV0LnZhbHVlID0gbWV0YWwuYnVmZmVyZWRfbWV0YWxfY29uY2VudHJhdGlvbi50b1N0cmluZygpO1xuICBpbnB1dC5jbGFzc0xpc3QuYWRkKHByZWZpeCk7XG4gIGlucHV0LmlkID0gcHJlZml4ICsgJ18nICsgbWV0YWwuaWRfc3VmZml4O1xuICBpbnB1dC50eXBlID0gJ251bWJlcic7XG4gIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgY29uc3QgdmFsID0gKDxIVE1MSW5wdXRFbGVtZW50PmV2ZW50LnRhcmdldCkudmFsdWU7XG4gICAgdmFyIGZsb2F0VmFsID0gcGFyc2VGbG9hdCh2YWwpOyAvLyBUT0RPOiB2YWxpZGF0aW9uIVxuICAgIGNvbnN0IG0gPSBtZXRhbHMuYWxsX21ldGFsc1ttZXRhbC5pZF9zdWZmaXhdO1xuICAgIE9iamVjdC5hc3NpZ24obSwgeyBbbWV0YWxQcm9wZXJ0eU5hbWVdOiBmbG9hdFZhbCB9KTtcbiAgICBpZiAoYWRkaXRpb25hbE9uQ2hhbmdlKSBhZGRpdGlvbmFsT25DaGFuZ2UobWV0YWwuaWRfc3VmZml4KTtcbiAgfSk7XG4gIHJldHVybiBpbnB1dDtcbn1cblxuZnVuY3Rpb24gYXBwZW5kTWV0YWxUYWJsZVJvdyhtZXRhbDogbWV0YWxzLk1ldGFsLCB0YWJsZTogSFRNTFRhYmxlRWxlbWVudCkge1xuICBjb25zdCByb3c6IEhUTUxUYWJsZVJvd0VsZW1lbnQgPSB0YWJsZS5pbnNlcnRSb3codGFibGUucm93cy5sZW5ndGgtMSk7XG5cbiAgcm93Lmluc2VydENlbGwoLTEpLm91dGVySFRNTCA9IFwiPHRoPlwiICsgbWV0YWwuc3ltYm9sICsgXCI8L3RoPlwiO1xuXG4gIGNvbnN0IGFmZmluaXR5X2NlbGw6IEhUTUxUYWJsZUNlbGxFbGVtZW50ID0gcm93Lmluc2VydENlbGwoLTEpO1xuICBhZmZpbml0eV9jZWxsLmNsYXNzTGlzdC5hZGQoJ2FmZmluaXR5Jyk7XG4gIGNvbnN0IGFmZmluaXR5X2lucHV0ID0gY3JlYXRlTWV0YWxOdW1iZXJJbnB1dCgnYWZmaW5pdHknLCBtZXRhbCwgJ2FmZmluaXR5JywgZnVuY3Rpb24oaWQpIHtcbiAgICBjb25zdCBtID0gbWV0YWxzLmFsbF9tZXRhbHNbaWRdO1xuICAgIG0ubWV0YWxhdGlvbl9kZWx0YV9HID0gbS5jYWxjdWxhdGVEZWx0YUcobS5hZmZpbml0eSk7XG4gICAgLy8gRklYTUU6IGNoYW5nZSB0aGlzIHRvIGJlIHdhdGNoZWQgYnkgTWV0YWw/XG4gICAgKDxIVE1MVGFibGVDZWxsRWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm1ldGFsYXRpb25fZGVsdGFfZ19cIiArIGlkKSkuaW5uZXJUZXh0ID0gbS5tZXRhbGF0aW9uX2RlbHRhX0cudG9GaXhlZCgxKS50b1N0cmluZygpO1xuICB9KTtcbiAgYWZmaW5pdHlfY2VsbC5hcHBlbmRDaGlsZChhZmZpbml0eV9pbnB1dCk7XG5cbiAgY29uc3QgbV9kZWx0YV9nX2NlbGw6IEhUTUxUYWJsZUNlbGxFbGVtZW50ID0gcm93Lmluc2VydENlbGwoLTEpO1xuICBtX2RlbHRhX2dfY2VsbC5pZCA9IFwibWV0YWxhdGlvbl9kZWx0YV9nX1wiICsgbWV0YWwuaWRfc3VmZml4O1xuICBtX2RlbHRhX2dfY2VsbC5pbm5lclRleHQgPSBtZXRhbC5tZXRhbGF0aW9uX2RlbHRhX0cudG9GaXhlZCgxKS50b1N0cmluZygpO1xuXG4gIGNvbnN0IGJtY19jZWxsOiBIVE1MVGFibGVDZWxsRWxlbWVudCA9IHJvdy5pbnNlcnRDZWxsKC0xKTtcbiAgYm1jX2NlbGwuY2xhc3NMaXN0LmFkZCgnYm1jJyk7XG4gIGNvbnN0IGJtY19pbnB1dCA9IGNyZWF0ZU1ldGFsTnVtYmVySW5wdXQoJ2JtYycsIG1ldGFsLCAnYnVmZmVyZWRfbWV0YWxfY29uY2VudHJhdGlvbicsIGZ1bmN0aW9uKGlkKSB7XG4gICAgY29uc3QgbSA9IG1ldGFscy5hbGxfbWV0YWxzW2lkXTtcbiAgICBtLmludHJhY2VsbHVsYXJfYXZhaWxhYmxlX2RlbHRhX0cgPSBtLmNhbGN1bGF0ZURlbHRhRyhtLmJ1ZmZlcmVkX21ldGFsX2NvbmNlbnRyYXRpb24pO1xuICAgIC8vRklYTUU6IGNoYW5nZSB0aGlzIHRvIGJlIHdhdGNoZWQgYnkgTWV0YWw/XG4gICAgKDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiaWFfZGVsdGFfZ19cIiArIGlkKSkudmFsdWUgPSBtLmludHJhY2VsbHVsYXJfYXZhaWxhYmxlX2RlbHRhX0cudG9TdHJpbmcoKTtcbiAgfSlcblxuICBibWNfY2VsbC5hcHBlbmRDaGlsZChibWNfaW5wdXQpO1xuXG4gIGNvbnN0IGlhX2RlbHRhX2dfY2VsbDogSFRNTFRhYmxlQ2VsbEVsZW1lbnQgPSByb3cuaW5zZXJ0Q2VsbCgtMSk7XG4gIGNvbnN0IGlhX2RlbHRhX2dfaW5wdXQgPSBjcmVhdGVNZXRhbE51bWJlcklucHV0KCdpYV9kZWx0YV9nJywgbWV0YWwsICdpbnRyYWNlbGx1bGFyX2F2YWlsYWJsZV9kZWx0YV9HJywgbnVsbCk7XG4gIGlhX2RlbHRhX2dfY2VsbC5hcHBlbmRDaGlsZChpYV9kZWx0YV9nX2lucHV0KTtcblxuICBjb25zdCByZXN1bHRfY2VsbDogSFRNTFRhYmxlQ2VsbEVsZW1lbnQgPSByb3cuaW5zZXJ0Q2VsbCgtMSk7XG4gIHJlc3VsdF9jZWxsLmlkID0gXCJyZXN1bHRfXCIgKyBtZXRhbC5pZF9zdWZmaXg7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZSgpIHtcbiAgY29uc3QgcmVzdWx0cyA9IG1ldGFscy5jYWxjdWxhdGVPY2N1cGFuY3koKTtcblxuICBmb3IgKHZhciBpZCBpbiBtZXRhbHMuYWxsX21ldGFscykge1xuICAgIGNvbnN0IHIgPSByZXN1bHRzW2lkXTtcbiAgICBjb25zdCByZXN1bHRfY2VsbCA9IDxIVE1MVGFibGVDZWxsRWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJlc3VsdF9cIiArIGlkKTtcbiAgICByZXN1bHRfY2VsbC5pbm5lckhUTUwgPSAociAqIDEwMCkudG9GaXhlZCgyKS50b1N0cmluZygpICsgJyUnO1xuICB9XG5cbiAgY29uc3QgdG90YWxfY2VsbCA9IDxIVE1MVGFibGVDZWxsRWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInRvdGFsX21ldGFsYXRpb25cIik7XG4gIHRvdGFsX2NlbGwuaW5uZXJIVE1MID0gKHJlc3VsdHNbJ3RvdGFsJ10gKiAxMDApLnRvRml4ZWQoMikudG9TdHJpbmcoKSArICclJztcbn1cblxuLy8gUXVpY2sgYW5kIHNpbXBsZSBleHBvcnQgdGFyZ2V0ICN0YWJsZV9pZCBpbnRvIGEgY3N2XG5mdW5jdGlvbiBkb3dubG9hZFRhYmxlQXNDc3YodGFibGVfaWQ6IHN0cmluZywgc2VwYXJhdG9yOiBzdHJpbmcgPSAnLCcpIHtcbiAgICAvLyBTZWxlY3Qgcm93cyBmcm9tIHRhYmxlX2lkXG4gICAgdmFyIHJvd3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCd0YWJsZSMnICsgdGFibGVfaWQgKyAnIHRyJyk7XG4gICAgLy8gQ29uc3RydWN0IGNzdlxuICAgIHZhciBjc3YgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJvd3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIHJvdyA9IFtdLCBjb2xzID0gPE5vZGVMaXN0T2Y8SFRNTFRhYmxlQ2VsbEVsZW1lbnQ+PnJvd3NbaV0ucXVlcnlTZWxlY3RvckFsbCgndGQsIHRoJyk7XG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgY29scy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgLy8gQ2xlYW4gaW5uZXJ0ZXh0IHRvIHJlbW92ZSBtdWx0aXBsZSBzcGFjZXMgYW5kIGp1bXBsaW5lIChicmVhayBjc3YpXG4gICAgICAgICAgICB2YXIgZGF0YTtcbiAgICAgICAgICAgIGNvbnN0IGlucHV0cyA9IGNvbHNbal0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2lucHV0Jyk7XG4gICAgICAgICAgICBpZiAoaW5wdXRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgZGF0YSA9IGlucHV0c1swXS52YWx1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGRhdGEgPSBjb2xzW2pdLmlubmVyVGV4dDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFJlbW92ZSBsaW5lIGJyZWFrcyBhbmQgZXNjYXBlIGRvdWJsZS1xdW90ZSB3aXRoIGRvdWJsZS1kb3VibGUtcXVvdGVcbiAgICAgICAgICAgIGRhdGEgPSBkYXRhLnJlcGxhY2UoLyhcXHJcXG58XFxufFxccikvZ20sICcnKS5yZXBsYWNlKC8oXFxzXFxzKS9nbSwgJyAnKTtcbiAgICAgICAgICAgIGRhdGEgPSBkYXRhLnJlcGxhY2UoL1wiL2csICdcIlwiJyk7XG4gICAgICAgICAgICAvLyBQdXNoIGVzY2FwZWQgc3RyaW5nXG4gICAgICAgICAgICByb3cucHVzaCgnXCInICsgZGF0YSArICdcIicpO1xuICAgICAgICB9XG4gICAgICAgIGNzdi5wdXNoKHJvdy5qb2luKHNlcGFyYXRvcikpO1xuICAgIH1cbiAgICB2YXIgY3N2X3N0cmluZyA9IGNzdi5qb2luKCdcXG4nKTtcbiAgICAvLyBEb3dubG9hZCBpdFxuICAgIHZhciBmaWxlbmFtZSA9ICdleHBvcnRfJyArIHRhYmxlX2lkICsgJ18nICsgbmV3IERhdGUoKS50b0xvY2FsZURhdGVTdHJpbmcoKSArICcuY3N2JztcbiAgICB2YXIgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgICBsaW5rLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgbGluay5zZXRBdHRyaWJ1dGUoJ3RhcmdldCcsICdfYmxhbmsnKTtcbiAgICBsaW5rLnNldEF0dHJpYnV0ZSgnaHJlZicsICdkYXRhOnRleHQvY3N2O2NoYXJzZXQ9dXRmLTgsJyArIGVuY29kZVVSSUNvbXBvbmVudChjc3Zfc3RyaW5nKSk7XG4gICAgbGluay5zZXRBdHRyaWJ1dGUoJ2Rvd25sb2FkJywgZmlsZW5hbWUpO1xuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobGluayk7XG4gICAgbGluay5jbGljaygpO1xuICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQobGluayk7XG59XG5cbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKGV2ZW50KSA9PiB7XG4gIGNvbnN0IG1ldGFsX3RhYmxlID0gPEhUTUxUYWJsZUVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGFsYXRpb25fdGFibGUnKTtcbiAgZm9yICh2YXIgaWQgaW4gbWV0YWxzLmFsbF9tZXRhbHMpIHtcbiAgICBjb25zdCBtID0gbWV0YWxzLmFsbF9tZXRhbHNbaWRdO1xuICAgIGFwcGVuZE1ldGFsVGFibGVSb3cobSwgbWV0YWxfdGFibGUpO1xuICB9XG5cbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbGN1bGF0ZV9idG4nKS5vbmNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgY2FsY3VsYXRlKCk7XG4gICAgKDxIVE1MQnV0dG9uRWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG93bmxvYWRfYnRuJykpLmRpc2FibGVkID0gZmFsc2U7XG4gIH07XG5cbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rvd25sb2FkX2J0bicpLm9uY2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgICBkb3dubG9hZFRhYmxlQXNDc3YoJ21ldGFsYXRpb25fdGFibGUnKTtcbiAgfTtcbn0pO1xuIiwiZXhwb3J0IGNsYXNzIE1ldGFsIHtcbiAgbmFtZTogc3RyaW5nO1xuICBzeW1ib2w6IHN0cmluZztcbiAgYWZmaW5pdHk6IG51bWJlcjtcbiAgbWV0YWxhdGlvbl9kZWx0YV9HOiBudW1iZXI7XG4gIGJ1ZmZlcmVkX21ldGFsX2NvbmNlbnRyYXRpb246IG51bWJlcjtcbiAgaW50cmFjZWxsdWxhcl9hdmFpbGFibGVfZGVsdGFfRzogbnVtYmVyO1xuICBpZF9zdWZmaXg6IHN0cmluZztcblxuICBjb25zdHJ1Y3RvcihuYW1lOnN0cmluZywgc3ltYm9sOnN0cmluZywgYWZmaW5pdHk6bnVtYmVyLCBjb25jZW50cmF0aW9uOm51bWJlcikge1xuICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgdGhpcy5zeW1ib2wgPSBzeW1ib2w7XG4gICAgdGhpcy5hZmZpbml0eSA9IGFmZmluaXR5O1xuICAgIHRoaXMubWV0YWxhdGlvbl9kZWx0YV9HID0gdGhpcy5jYWxjdWxhdGVEZWx0YUcoYWZmaW5pdHkpO1xuICAgIHRoaXMuYnVmZmVyZWRfbWV0YWxfY29uY2VudHJhdGlvbiA9IGNvbmNlbnRyYXRpb247XG4gICAgdGhpcy5pbnRyYWNlbGx1bGFyX2F2YWlsYWJsZV9kZWx0YV9HID0gdGhpcy5jYWxjdWxhdGVEZWx0YUcoY29uY2VudHJhdGlvbik7XG4gICAgdGhpcy5pZF9zdWZmaXggPSBzeW1ib2wudG9Mb3dlckNhc2UoKTtcbiAgfVxuXG4gIGNhbGN1bGF0ZURlbHRhRyhtb2xlX3ZhbHVlOiBudW1iZXIpOiBudW1iZXIge1xuICAgIHJldHVybiA4LjMxNCAqIDI5OC4xNSAqIE1hdGgubG9nKG1vbGVfdmFsdWUpIC8gMTAwMDtcbiAgfVxufVxuXG5jb25zdCBtZXRhbF92YWxzOiBBcnJheTxbc3RyaW5nLCBzdHJpbmcsIG51bWJlciwgbnVtYmVyXT4gPSBbXG4gIFtcIk1hZ25lc2l1bVwiLCBcIk1nXCIsIDFFMywgMi43RS0zXSxcbiAgW1wiTWFuZ2FuZXNlXCIsIFwiTW5cIiwgMUUzLCAyLjZFLTZdLFxuICBbXCJJcm9uXCIsIFwiRmVcIiwgMUUtNiwgNC44RS04XSxcbiAgW1wiQ29iYWx0XCIsIFwiQ29cIiwgM0UtMTEsIDIuNUUtOV0sXG4gIFtcIk5pY2tlbFwiLCBcIk5pXCIsIDkuOEUtMTAsIDEuOEUtMTNdLFxuICBbXCJDb3BwZXJcIiwgXCJDdVwiLCAyLjRFLTE2LCAxLjJFLTE4XSxcbiAgW1wiWmluY1wiLCBcIlpuXCIsIDEuOUUtMTMsIDEuMTlFLTEyXSxcbl1cblxuZXhwb3J0IGNvbnN0IGFsbF9tZXRhbHM6IHsgW2lkOiBzdHJpbmddOiBNZXRhbDsgfSA9IHt9O1xuXG5mb3IgKHZhciBtIG9mIG1ldGFsX3ZhbHMpIHtcbiAgYWxsX21ldGFsc1ttWzFdLnRvTG93ZXJDYXNlKCldID0gbmV3IE1ldGFsKC4uLm0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2FsY3VsYXRlT2NjdXBhbmN5KCkge1xuICB2YXIgZXhwX3NjYWxlZF9kaWZmZXJlbmNlczogeyBbaWQ6IHN0cmluZ106IG51bWJlcjsgfSA9IHt9O1xuICB2YXIgdG90YWxfZGlmZnM6IG51bWJlciA9IDA7XG4gIGZvciAodmFyIGlkIGluIGFsbF9tZXRhbHMpIHtcbiAgICBjb25zdCBtID0gYWxsX21ldGFsc1tpZF07XG4gICAgZXhwX3NjYWxlZF9kaWZmZXJlbmNlc1tpZF0gPSBNYXRoLmV4cChcbiAgICAgIDEwMDAgKiAobS5pbnRyYWNlbGx1bGFyX2F2YWlsYWJsZV9kZWx0YV9HIC0gbS5tZXRhbGF0aW9uX2RlbHRhX0cpXG4gICAgICAvICg4LjMxNCAqIDI5OC4xNSlcbiAgICApO1xuICAgIHRvdGFsX2RpZmZzICs9IGV4cF9zY2FsZWRfZGlmZmVyZW5jZXNbaWRdO1xuICB9XG5cbiAgdmFyIG9jY3VwYW5jaWVzOiB7IFtpZDogc3RyaW5nXTogbnVtYmVyOyB9ID0ge307XG4gIHZhciB0b3RhbF9vY2N1cGFuY3k6IG51bWJlciA9IDA7XG5cbiAgZm9yICh2YXIgaWQgaW4gYWxsX21ldGFscykge1xuICAgIG9jY3VwYW5jaWVzW2lkXSA9IGV4cF9zY2FsZWRfZGlmZmVyZW5jZXNbaWRdIC8gKDEgKyB0b3RhbF9kaWZmcyk7XG4gICAgdG90YWxfb2NjdXBhbmN5ICs9IG9jY3VwYW5jaWVzW2lkXTtcbiAgfVxuICBvY2N1cGFuY2llc1sndG90YWwnXSA9IHRvdGFsX29jY3VwYW5jeTtcblxuICByZXR1cm4gb2NjdXBhbmNpZXM7XG59XG4iXX0=
