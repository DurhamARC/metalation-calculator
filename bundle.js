(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var metals = require("./metals");
function createMetalNumberInput(prefix, metal, metalPropertyName, additionalOnChange) {
    var div = document.createElement('div');
    var input = document.createElement('input');
    var msg_p = document.createElement('p');
    msg_p.classList.add('error_msg');
    input.value = metal.getProperty(metalPropertyName).toString();
    input.classList.add(prefix);
    input.id = prefix + '_' + metal.id_suffix;
    input.type = 'number';
    input.addEventListener('change', function (event) {
        var _a;
        var val = event.target.value;
        try {
            msg_p.textContent = '';
            var floatVal = parseFloat(val);
            var m = metals.all_metals[metal.id_suffix];
            Object.assign(m, (_a = {}, _a[metalPropertyName] = floatVal, _a));
            if (additionalOnChange)
                additionalOnChange(metal.id_suffix);
            calculate();
        }
        catch (e) {
            var msg;
            if (e instanceof RangeError) {
                msg = e.message;
            }
            else {
                msg = 'Invalid value ' + input.value;
            }
            msg_p.textContent = msg;
            clearCalculation();
        }
    });
    div.append(input);
    div.append(msg_p);
    return div;
}
function appendMetalTableRow(metal, table) {
    var row = table.insertRow(table.rows.length - 1);
    row.insertCell(-1).outerHTML = "<th>" + metal.symbol + "</th>";
    var affinity_cell = row.insertCell(-1);
    affinity_cell.classList.add('affinity');
    var affinity_input = createMetalNumberInput('affinity', metal, 'affinity', function (id) {
        var m = metals.all_metals[id];
        document.getElementById("metalation_delta_g_" + id).innerText = m.metalation_delta_G.toFixed(1).toString();
    });
    affinity_cell.appendChild(affinity_input);
    var m_delta_g_cell = row.insertCell(-1);
    m_delta_g_cell.id = "metalation_delta_g_" + metal.id_suffix;
    m_delta_g_cell.innerText = metal.metalation_delta_G.toFixed(1).toString();
    var bmc_cell = row.insertCell(-1);
    bmc_cell.classList.add('bmc');
    var bmc_input = createMetalNumberInput('bmc', metal, 'buffered_metal_concentration', function (id) {
        var m = metals.all_metals[id];
        document.getElementById("ia_delta_g_" + id).innerText = m.intracellular_available_delta_G.toFixed(1).toString();
    });
    bmc_cell.appendChild(bmc_input);
    var ia_delta_g_cell = row.insertCell(-1);
    ia_delta_g_cell.id = "ia_delta_g_" + metal.id_suffix;
    ia_delta_g_cell.innerText = metal.intracellular_available_delta_G.toFixed(1).toString();
    var result_cell = row.insertCell(-1);
    result_cell.classList.add("result");
    result_cell.id = "result_" + metal.id_suffix;
}
function calculate() {
    var results = metals.calculateOccupancy();
    for (var id in metals.all_metals) {
        var r = results[id];
        var result_cell = document.getElementById("result_" + id);
        result_cell.innerHTML = (r * 100).toFixed(2).toString() + '%';
    }
    var total_cell = document.getElementById("total_metalation");
    total_cell.innerHTML = (results['total'] * 100).toFixed(2).toString() + '%';
    document.getElementById('download_btn').disabled = false;
}
function clearCalculation() {
    Array.from(document.getElementsByClassName("result")).forEach(function (cell) {
        cell.innerHTML = 'N/A';
    });
    document.getElementById('download_btn').disabled = true;
}
// Quick and simple export target #table_id into a csv
function downloadTableAsCsv(table_id, separator) {
    if (separator === void 0) { separator = ','; }
    // Select rows from table_id
    var rows = document.querySelectorAll('table#' + table_id + ' tr');
    // Construct csv
    var csv = [];
    for (var i = 0; i < rows.length; i++) {
        var row = [], cols = rows[i].querySelectorAll('td, th');
        for (var j = 0; j < cols.length; j++) {
            // Clean innertext to remove multiple spaces and jumpline (break csv)
            var data;
            var inputs = cols[j].getElementsByTagName('input');
            if (inputs.length > 0) {
                data = inputs[0].value;
            }
            else {
                data = cols[j].innerText;
            }
            // Remove line breaks and escape double-quote with double-double-quote
            data = data.replace(/(\r\n|\n|\r)/gm, '').replace(/(\s\s)/gm, ' ');
            data = data.replace(/"/g, '""');
            // Push escaped string
            row.push('"' + data + '"');
        }
        csv.push(row.join(separator));
    }
    var csv_string = csv.join('\n');
    // Download it
    var filename = 'export_' + table_id + '_' + new Date().toLocaleDateString() + '.csv';
    var link = document.createElement('a');
    link.style.display = 'none';
    link.setAttribute('target', '_blank');
    link.setAttribute('href', 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv_string));
    link.setAttribute('download', filename);
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}
window.addEventListener('DOMContentLoaded', function (event) {
    var metal_table = document.getElementById('metalation_table');
    for (var id in metals.all_metals) {
        var m = metals.all_metals[id];
        appendMetalTableRow(m, metal_table);
    }
    document.getElementById('download_btn').onclick = function () {
        downloadTableAsCsv('metalation_table');
    };
    calculate();
});

},{"./metals":2}],2:[function(require,module,exports){
"use strict";
var __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {
    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {
        if (ar || !(i in from)) {
            if (!ar) ar = Array.prototype.slice.call(from, 0, i);
            ar[i] = from[i];
        }
    }
    return to.concat(ar || Array.prototype.slice.call(from));
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.calculateOccupancy = exports.all_metals = exports.Metal = void 0;
var Metal = /** @class */ (function () {
    function Metal(name, symbol, affinity, concentration) {
        this.name = name;
        this.symbol = symbol;
        this.affinity = affinity;
        this.buffered_metal_concentration = concentration;
        this.id_suffix = symbol.toLowerCase();
    }
    Metal.prototype.calculateDeltaG = function (mole_value) {
        return 8.314 * 298.15 * Math.log(mole_value) / 1000;
    };
    Metal.prototype.checkRange = function (val, field_name) {
        if (isNaN(val))
            throw new RangeError(field_name + " must be set");
        if (val < 1e-30 || val > 1000) {
            throw new RangeError(field_name + " must be between 1e-30 and 1000");
        }
    };
    Object.defineProperty(Metal.prototype, "affinity", {
        get: function () {
            return this._affinity;
        },
        set: function (val) {
            this.checkRange(val, "Affinity");
            this._affinity = val;
            this._metalation_delta_G = this.calculateDeltaG(this._affinity);
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(Metal.prototype, "metalation_delta_G", {
        get: function () {
            return this._metalation_delta_G;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(Metal.prototype, "buffered_metal_concentration", {
        get: function () {
            return this._buffered_metal_concentration;
        },
        set: function (val) {
            this.checkRange(val, "Buffered metal concentration");
            this._buffered_metal_concentration = val;
            this._intracellular_available_delta_G = this.calculateDeltaG(this._buffered_metal_concentration);
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(Metal.prototype, "intracellular_available_delta_G", {
        get: function () {
            return this._intracellular_available_delta_G;
        },
        set: function (val) {
            if (val <= 0)
                throw new RangeError("Intracellular available âˆ†G must be > 0");
            this._intracellular_available_delta_G = val;
        },
        enumerable: false,
        configurable: true
    });
    Metal.prototype.getProperty = function (key) {
        return this[key];
    };
    return Metal;
}());
exports.Metal = Metal;
var metal_vals = [
    ["Magnesium", "Mg", 1E3, 2.7E-3],
    ["Manganese", "Mn", 1E3, 2.6E-6],
    ["Iron", "Fe", 1E-6, 4.8E-8],
    ["Cobalt", "Co", 3E-11, 2.5E-9],
    ["Nickel", "Ni", 9.8E-10, 1.8E-13],
    ["Copper", "Cu", 2.4E-16, 1.2E-18],
    ["Zinc", "Zn", 1.9E-13, 1.19E-12],
];
exports.all_metals = {};
for (var _i = 0, metal_vals_1 = metal_vals; _i < metal_vals_1.length; _i++) {
    var m = metal_vals_1[_i];
    exports.all_metals[m[1].toLowerCase()] = new (Metal.bind.apply(Metal, __spreadArray([void 0], m, false)))();
}
function calculateOccupancy() {
    var exp_scaled_differences = {};
    var total_diffs = 0;
    for (var id in exports.all_metals) {
        var m_1 = exports.all_metals[id];
        exp_scaled_differences[id] = Math.exp(1000 * (m_1.intracellular_available_delta_G - m_1.metalation_delta_G)
            / (8.314 * 298.15));
        total_diffs += exp_scaled_differences[id];
    }
    var occupancies = {};
    var total_occupancy = 0;
    for (var id in exports.all_metals) {
        occupancies[id] = exp_scaled_differences[id] / (1 + total_diffs);
        total_occupancy += occupancies[id];
    }
    occupancies['total'] = total_occupancy;
    return occupancies;
}
exports.calculateOccupancy = calculateOccupancy;

},{}]},{},[1,2])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvbWFpbi50cyIsInNyYy9tZXRhbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7OztBQ0FBLGlDQUFrQztBQUVsQyxTQUFTLHNCQUFzQixDQUFDLE1BQWUsRUFBRSxLQUFvQixFQUFFLGlCQUFxQyxFQUFFLGtCQUF3QztJQUNwSixJQUFNLEdBQUcsR0FBbUIsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUMxRCxJQUFNLEtBQUssR0FBcUIsUUFBUSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUNoRSxJQUFNLEtBQUssR0FBeUIsUUFBUSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNoRSxLQUFLLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQTtJQUNoQyxLQUFLLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQyxXQUFXLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUM5RCxLQUFLLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUM1QixLQUFLLENBQUMsRUFBRSxHQUFHLE1BQU0sR0FBRyxHQUFHLEdBQUcsS0FBSyxDQUFDLFNBQVMsQ0FBQztJQUMxQyxLQUFLLENBQUMsSUFBSSxHQUFHLFFBQVEsQ0FBQztJQUN0QixLQUFLLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxFQUFFLFVBQVMsS0FBSzs7UUFDN0MsSUFBTSxHQUFHLEdBQXNCLEtBQUssQ0FBQyxNQUFPLENBQUMsS0FBSyxDQUFDO1FBQ25ELElBQUk7WUFDRixLQUFLLENBQUMsV0FBVyxHQUFHLEVBQUUsQ0FBQztZQUN2QixJQUFJLFFBQVEsR0FBRyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDL0IsSUFBTSxDQUFDLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsU0FB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QUFDLFlBQUMsQ0FBQztDQUNsRDtBQUVELFNBQWdCLGtCQUFrQjtJQUNoQyxJQUFJLHNCQUFzQixHQUE4QixFQUFFLENBQUM7SUFDM0QsSUFBSSxXQUFXLEdBQVcsQ0FBQyxDQUFDO0lBQzVCLEtBQUssSUFBSSxFQUFFLElBQUksa0JBQVUsRUFBRTtRQUN6QixJQUFNLEdBQUMsR0FBRyxrQkFBVSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3pCLHNCQUFzQixDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQ25DLElBQUksR0FBRyxDQUFDLEdBQUMsQ0FBQywrQkFBK0IsR0FBRyxHQUFDLENBQUMsa0JBQWtCLENBQUM7Y0FDL0QsQ0FBQyxLQUFLLEdBQUcsTUFBTSxDQUFDLENBQ25CLENBQUM7UUFDRixXQUFXLElBQUksc0JBQXNCLENBQUMsRUFBRSxDQUFDLENBQUM7S0FDM0M7SUFFRCxJQUFJLFdBQVcsR0FBOEIsRUFBRSxDQUFDO0lBQ2hELElBQUksZUFBZSxHQUFXLENBQUMsQ0FBQztJQUVoQyxLQUFLLElBQUksRUFBRSxJQUFJLGtCQUFVLEVBQUU7UUFDekIsV0FBVyxDQUFDLEVBQUUsQ0FBQyxHQUFHLHNCQUFzQixDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLFdBQVcsQ0FBQyxDQUFDO1FBQ2pFLGVBQWUsSUFBSSxXQUFXLENBQUMsRUFBRSxDQUFDLENBQUM7S0FDcEM7SUFDRCxXQUFXLENBQUMsT0FBTyxDQUFDLEdBQUcsZUFBZSxDQUFDO0lBRXZDLE9BQU8sV0FBVyxDQUFDO0FBQ3JCLENBQUM7QUF0QkQsZ0RBc0JDIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiaW1wb3J0ICogYXMgbWV0YWxzIGZyb20gXCIuL21ldGFsc1wiXG5cbmZ1bmN0aW9uIGNyZWF0ZU1ldGFsTnVtYmVySW5wdXQocHJlZml4IDogc3RyaW5nLCBtZXRhbCA6IG1ldGFscy5NZXRhbCwgbWV0YWxQcm9wZXJ0eU5hbWU6IGtleW9mIG1ldGFscy5NZXRhbCwgYWRkaXRpb25hbE9uQ2hhbmdlOiAoaWQ6IHN0cmluZykgPT4gdm9pZCkge1xuICBjb25zdCBkaXYgPSA8SFRNTERpdkVsZW1lbnQ+ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIGNvbnN0IGlucHV0ID0gPEhUTUxJbnB1dEVsZW1lbnQ+ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgY29uc3QgbXNnX3AgPSA8SFRNTFBhcmFncmFwaEVsZW1lbnQ+ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBtc2dfcC5jbGFzc0xpc3QuYWRkKCdlcnJvcl9tc2cnKVxuICBpbnB1dC52YWx1ZSA9IG1ldGFsLmdldFByb3BlcnR5KG1ldGFsUHJvcGVydHlOYW1lKS50b1N0cmluZygpO1xuICBpbnB1dC5jbGFzc0xpc3QuYWRkKHByZWZpeCk7XG4gIGlucHV0LmlkID0gcHJlZml4ICsgJ18nICsgbWV0YWwuaWRfc3VmZml4O1xuICBpbnB1dC50eXBlID0gJ251bWJlcic7XG4gIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgY29uc3QgdmFsID0gKDxIVE1MSW5wdXRFbGVtZW50PmV2ZW50LnRhcmdldCkudmFsdWU7XG4gICAgdHJ5IHtcbiAgICAgIG1zZ19wLnRleHRDb250ZW50ID0gJyc7XG4gICAgICB2YXIgZmxvYXRWYWwgPSBwYXJzZUZsb2F0KHZhbCk7XG4gICAgICBjb25zdCBtID0gbWV0YWxzLmFsbF9tZXRhbHNbbWV0YWwuaWRfc3VmZml4XTtcbiAgICAgIE9iamVjdC5hc3NpZ24obSwgeyBbbWV0YWxQcm9wZXJ0eU5hbWVdOiBmbG9hdFZhbCB9KTtcbiAgICAgIGlmIChhZGRpdGlvbmFsT25DaGFuZ2UpIGFkZGl0aW9uYWxPbkNoYW5nZShtZXRhbC5pZF9zdWZmaXgpO1xuICAgICAgY2FsY3VsYXRlKCk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgdmFyIG1zZztcbiAgICAgIGlmIChlIGluc3RhbmNlb2YgUmFuZ2VFcnJvcikge1xuICAgICAgICBtc2cgPSBlLm1lc3NhZ2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBtc2cgPSAnSW52YWxpZCB2YWx1ZSAnICsgaW5wdXQudmFsdWU7XG4gICAgICB9XG4gICAgICBtc2dfcC50ZXh0Q29udGVudCA9IG1zZztcbiAgICAgIGNsZWFyQ2FsY3VsYXRpb24oKTtcbiAgICB9XG4gIH0pO1xuICBkaXYuYXBwZW5kKGlucHV0KTtcbiAgZGl2LmFwcGVuZChtc2dfcCk7XG4gIHJldHVybiBkaXY7XG59XG5cbmZ1bmN0aW9uIGFwcGVuZE1ldGFsVGFibGVSb3cobWV0YWw6IG1ldGFscy5NZXRhbCwgdGFibGU6IEhUTUxUYWJsZUVsZW1lbnQpIHtcbiAgY29uc3Qgcm93OiBIVE1MVGFibGVSb3dFbGVtZW50ID0gdGFibGUuaW5zZXJ0Um93KHRhYmxlLnJvd3MubGVuZ3RoLTEpO1xuXG4gIHJvdy5pbnNlcnRDZWxsKC0xKS5vdXRlckhUTUwgPSBcIjx0aD5cIiArIG1ldGFsLnN5bWJvbCArIFwiPC90aD5cIjtcblxuICBjb25zdCBhZmZpbml0eV9jZWxsOiBIVE1MVGFibGVDZWxsRWxlbWVudCA9IHJvdy5pbnNlcnRDZWxsKC0xKTtcbiAgYWZmaW5pdHlfY2VsbC5jbGFzc0xpc3QuYWRkKCdhZmZpbml0eScpO1xuICBjb25zdCBhZmZpbml0eV9pbnB1dCA9IGNyZWF0ZU1ldGFsTnVtYmVySW5wdXQoJ2FmZmluaXR5JywgbWV0YWwsICdhZmZpbml0eScsIGZ1bmN0aW9uKGlkKSB7XG4gICAgY29uc3QgbSA9IG1ldGFscy5hbGxfbWV0YWxzW2lkXTtcbiAgICAoPEhUTUxUYWJsZUNlbGxFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibWV0YWxhdGlvbl9kZWx0YV9nX1wiICsgaWQpKS5pbm5lclRleHQgPSBtLm1ldGFsYXRpb25fZGVsdGFfRy50b0ZpeGVkKDEpLnRvU3RyaW5nKCk7XG4gIH0pO1xuICBhZmZpbml0eV9jZWxsLmFwcGVuZENoaWxkKGFmZmluaXR5X2lucHV0KTtcblxuICBjb25zdCBtX2RlbHRhX2dfY2VsbDogSFRNTFRhYmxlQ2VsbEVsZW1lbnQgPSByb3cuaW5zZXJ0Q2VsbCgtMSk7XG4gIG1fZGVsdGFfZ19jZWxsLmlkID0gXCJtZXRhbGF0aW9uX2RlbHRhX2dfXCIgKyBtZXRhbC5pZF9zdWZmaXg7XG4gIG1fZGVsdGFfZ19jZWxsLmlubmVyVGV4dCA9IG1ldGFsLm1ldGFsYXRpb25fZGVsdGFfRy50b0ZpeGVkKDEpLnRvU3RyaW5nKCk7XG5cbiAgY29uc3QgYm1jX2NlbGw6IEhUTUxUYWJsZUNlbGxFbGVtZW50ID0gcm93Lmluc2VydENlbGwoLTEpO1xuICBibWNfY2VsbC5jbGFzc0xpc3QuYWRkKCdibWMnKTtcbiAgY29uc3QgYm1jX2lucHV0ID0gY3JlYXRlTWV0YWxOdW1iZXJJbnB1dCgnYm1jJywgbWV0YWwsICdidWZmZXJlZF9tZXRhbF9jb25jZW50cmF0aW9uJywgZnVuY3Rpb24oaWQpIHtcbiAgICBjb25zdCBtID0gbWV0YWxzLmFsbF9tZXRhbHNbaWRdO1xuICAgICg8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImlhX2RlbHRhX2dfXCIgKyBpZCkpLmlubmVyVGV4dCA9IG0uaW50cmFjZWxsdWxhcl9hdmFpbGFibGVfZGVsdGFfRy50b0ZpeGVkKDEpLnRvU3RyaW5nKCk7XG4gIH0pXG5cbiAgYm1jX2NlbGwuYXBwZW5kQ2hpbGQoYm1jX2lucHV0KTtcblxuICBjb25zdCBpYV9kZWx0YV9nX2NlbGw6IEhUTUxUYWJsZUNlbGxFbGVtZW50ID0gcm93Lmluc2VydENlbGwoLTEpO1xuICBpYV9kZWx0YV9nX2NlbGwuaWQgPSBcImlhX2RlbHRhX2dfXCIgKyBtZXRhbC5pZF9zdWZmaXg7XG4gIGlhX2RlbHRhX2dfY2VsbC5pbm5lclRleHQgPSBtZXRhbC5pbnRyYWNlbGx1bGFyX2F2YWlsYWJsZV9kZWx0YV9HLnRvRml4ZWQoMSkudG9TdHJpbmcoKTtcblxuICBjb25zdCByZXN1bHRfY2VsbDogSFRNTFRhYmxlQ2VsbEVsZW1lbnQgPSByb3cuaW5zZXJ0Q2VsbCgtMSk7XG4gIHJlc3VsdF9jZWxsLmNsYXNzTGlzdC5hZGQoXCJyZXN1bHRcIik7XG4gIHJlc3VsdF9jZWxsLmlkID0gXCJyZXN1bHRfXCIgKyBtZXRhbC5pZF9zdWZmaXg7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZSgpIHtcbiAgY29uc3QgcmVzdWx0cyA9IG1ldGFscy5jYWxjdWxhdGVPY2N1cGFuY3koKTtcblxuICBmb3IgKHZhciBpZCBpbiBtZXRhbHMuYWxsX21ldGFscykge1xuICAgIGNvbnN0IHIgPSByZXN1bHRzW2lkXTtcbiAgICBjb25zdCByZXN1bHRfY2VsbCA9IDxIVE1MVGFibGVDZWxsRWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJlc3VsdF9cIiArIGlkKTtcbiAgICByZXN1bHRfY2VsbC5pbm5lckhUTUwgPSAociAqIDEwMCkudG9GaXhlZCgyKS50b1N0cmluZygpICsgJyUnO1xuICB9XG5cbiAgY29uc3QgdG90YWxfY2VsbCA9IDxIVE1MVGFibGVDZWxsRWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInRvdGFsX21ldGFsYXRpb25cIik7XG4gIHRvdGFsX2NlbGwuaW5uZXJIVE1MID0gKHJlc3VsdHNbJ3RvdGFsJ10gKiAxMDApLnRvRml4ZWQoMikudG9TdHJpbmcoKSArICclJztcblxuICAoPEhUTUxCdXR0b25FbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkb3dubG9hZF9idG4nKSkuZGlzYWJsZWQgPSBmYWxzZTtcbn1cblxuZnVuY3Rpb24gY2xlYXJDYWxjdWxhdGlvbigpIHtcbiAgQXJyYXkuZnJvbShkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwicmVzdWx0XCIpKS5mb3JFYWNoKGNlbGwgPT4ge1xuICAgICAgY2VsbC5pbm5lckhUTUwgPSAnTi9BJztcbiAgfSk7XG4gICg8SFRNTEJ1dHRvbkVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rvd25sb2FkX2J0bicpKS5kaXNhYmxlZCA9IHRydWU7XG59XG5cbi8vIFF1aWNrIGFuZCBzaW1wbGUgZXhwb3J0IHRhcmdldCAjdGFibGVfaWQgaW50byBhIGNzdlxuZnVuY3Rpb24gZG93bmxvYWRUYWJsZUFzQ3N2KHRhYmxlX2lkOiBzdHJpbmcsIHNlcGFyYXRvcjogc3RyaW5nID0gJywnKSB7XG4gICAgLy8gU2VsZWN0IHJvd3MgZnJvbSB0YWJsZV9pZFxuICAgIHZhciByb3dzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgndGFibGUjJyArIHRhYmxlX2lkICsgJyB0cicpO1xuICAgIC8vIENvbnN0cnVjdCBjc3ZcbiAgICB2YXIgY3N2ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCByb3dzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciByb3cgPSBbXSwgY29scyA9IDxOb2RlTGlzdE9mPEhUTUxUYWJsZUNlbGxFbGVtZW50Pj5yb3dzW2ldLnF1ZXJ5U2VsZWN0b3JBbGwoJ3RkLCB0aCcpO1xuICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGNvbHMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgIC8vIENsZWFuIGlubmVydGV4dCB0byByZW1vdmUgbXVsdGlwbGUgc3BhY2VzIGFuZCBqdW1wbGluZSAoYnJlYWsgY3N2KVxuICAgICAgICAgICAgdmFyIGRhdGE7XG4gICAgICAgICAgICBjb25zdCBpbnB1dHMgPSBjb2xzW2pdLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdpbnB1dCcpO1xuICAgICAgICAgICAgaWYgKGlucHV0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgIGRhdGEgPSBpbnB1dHNbMF0udmFsdWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBkYXRhID0gY29sc1tqXS5pbm5lclRleHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBSZW1vdmUgbGluZSBicmVha3MgYW5kIGVzY2FwZSBkb3VibGUtcXVvdGUgd2l0aCBkb3VibGUtZG91YmxlLXF1b3RlXG4gICAgICAgICAgICBkYXRhID0gZGF0YS5yZXBsYWNlKC8oXFxyXFxufFxcbnxcXHIpL2dtLCAnJykucmVwbGFjZSgvKFxcc1xccykvZ20sICcgJyk7XG4gICAgICAgICAgICBkYXRhID0gZGF0YS5yZXBsYWNlKC9cIi9nLCAnXCJcIicpO1xuICAgICAgICAgICAgLy8gUHVzaCBlc2NhcGVkIHN0cmluZ1xuICAgICAgICAgICAgcm93LnB1c2goJ1wiJyArIGRhdGEgKyAnXCInKTtcbiAgICAgICAgfVxuICAgICAgICBjc3YucHVzaChyb3cuam9pbihzZXBhcmF0b3IpKTtcbiAgICB9XG4gICAgdmFyIGNzdl9zdHJpbmcgPSBjc3Yuam9pbignXFxuJyk7XG4gICAgLy8gRG93bmxvYWQgaXRcbiAgICB2YXIgZmlsZW5hbWUgPSAnZXhwb3J0XycgKyB0YWJsZV9pZCArICdfJyArIG5ldyBEYXRlKCkudG9Mb2NhbGVEYXRlU3RyaW5nKCkgKyAnLmNzdic7XG4gICAgdmFyIGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XG4gICAgbGluay5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgIGxpbmsuc2V0QXR0cmlidXRlKCd0YXJnZXQnLCAnX2JsYW5rJyk7XG4gICAgbGluay5zZXRBdHRyaWJ1dGUoJ2hyZWYnLCAnZGF0YTp0ZXh0L2NzdjtjaGFyc2V0PXV0Zi04LCcgKyBlbmNvZGVVUklDb21wb25lbnQoY3N2X3N0cmluZykpO1xuICAgIGxpbmsuc2V0QXR0cmlidXRlKCdkb3dubG9hZCcsIGZpbGVuYW1lKTtcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmspO1xuICAgIGxpbmsuY2xpY2soKTtcbiAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGxpbmspO1xufVxuXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIChldmVudCkgPT4ge1xuICBjb25zdCBtZXRhbF90YWJsZSA9IDxIVE1MVGFibGVFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhbGF0aW9uX3RhYmxlJyk7XG4gIGZvciAodmFyIGlkIGluIG1ldGFscy5hbGxfbWV0YWxzKSB7XG4gICAgY29uc3QgbSA9IG1ldGFscy5hbGxfbWV0YWxzW2lkXTtcbiAgICBhcHBlbmRNZXRhbFRhYmxlUm93KG0sIG1ldGFsX3RhYmxlKTtcbiAgfVxuXG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkb3dubG9hZF9idG4nKS5vbmNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgZG93bmxvYWRUYWJsZUFzQ3N2KCdtZXRhbGF0aW9uX3RhYmxlJyk7XG4gIH07XG5cbiAgY2FsY3VsYXRlKCk7XG59KTtcbiIsImV4cG9ydCBjbGFzcyBNZXRhbCB7XG4gIG5hbWU6IHN0cmluZztcbiAgc3ltYm9sOiBzdHJpbmc7XG4gIF9hZmZpbml0eTogbnVtYmVyO1xuICBfbWV0YWxhdGlvbl9kZWx0YV9HOiBudW1iZXI7XG4gIF9idWZmZXJlZF9tZXRhbF9jb25jZW50cmF0aW9uOiBudW1iZXI7XG4gIF9pbnRyYWNlbGx1bGFyX2F2YWlsYWJsZV9kZWx0YV9HOiBudW1iZXI7XG4gIGlkX3N1ZmZpeDogc3RyaW5nO1xuICB2YWxpZGF0b3I6IHR5cGVvZiBQcm94eTtcblxuICBjb25zdHJ1Y3RvcihuYW1lOnN0cmluZywgc3ltYm9sOnN0cmluZywgYWZmaW5pdHk6bnVtYmVyLCBjb25jZW50cmF0aW9uOm51bWJlcikge1xuICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgdGhpcy5zeW1ib2wgPSBzeW1ib2w7XG4gICAgdGhpcy5hZmZpbml0eSA9IGFmZmluaXR5O1xuICAgIHRoaXMuYnVmZmVyZWRfbWV0YWxfY29uY2VudHJhdGlvbiA9IGNvbmNlbnRyYXRpb247XG4gICAgdGhpcy5pZF9zdWZmaXggPSBzeW1ib2wudG9Mb3dlckNhc2UoKTtcbiAgfVxuXG4gIGNhbGN1bGF0ZURlbHRhRyhtb2xlX3ZhbHVlOiBudW1iZXIpOiBudW1iZXIge1xuICAgIHJldHVybiA4LjMxNCAqIDI5OC4xNSAqIE1hdGgubG9nKG1vbGVfdmFsdWUpIC8gMTAwMDtcbiAgfVxuXG4gIGNoZWNrUmFuZ2UodmFsOiBudW1iZXIsIGZpZWxkX25hbWU6IHN0cmluZykge1xuICAgIGlmIChpc05hTih2YWwpKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcihmaWVsZF9uYW1lICsgXCIgbXVzdCBiZSBzZXRcIilcbiAgICBpZiAodmFsIDwgMWUtMzAgfHwgdmFsID4gMTAwMCkge1xuICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoZmllbGRfbmFtZSArIFwiIG11c3QgYmUgYmV0d2VlbiAxZS0zMCBhbmQgMTAwMFwiKTtcbiAgICB9XG4gIH1cblxuICBnZXQgYWZmaW5pdHkoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5fYWZmaW5pdHk7XG4gIH1cblxuICBzZXQgYWZmaW5pdHkodmFsOm51bWJlcikge1xuICAgIHRoaXMuY2hlY2tSYW5nZSh2YWwsIFwiQWZmaW5pdHlcIik7XG4gICAgdGhpcy5fYWZmaW5pdHkgPSB2YWw7XG4gICAgdGhpcy5fbWV0YWxhdGlvbl9kZWx0YV9HID0gdGhpcy5jYWxjdWxhdGVEZWx0YUcodGhpcy5fYWZmaW5pdHkpO1xuICB9XG5cbiAgZ2V0IG1ldGFsYXRpb25fZGVsdGFfRygpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLl9tZXRhbGF0aW9uX2RlbHRhX0c7XG4gIH1cblxuICBnZXQgYnVmZmVyZWRfbWV0YWxfY29uY2VudHJhdGlvbigpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLl9idWZmZXJlZF9tZXRhbF9jb25jZW50cmF0aW9uO1xuICB9XG5cbiAgc2V0IGJ1ZmZlcmVkX21ldGFsX2NvbmNlbnRyYXRpb24odmFsOm51bWJlcikge1xuICAgIHRoaXMuY2hlY2tSYW5nZSh2YWwsIFwiQnVmZmVyZWQgbWV0YWwgY29uY2VudHJhdGlvblwiKTtcbiAgICB0aGlzLl9idWZmZXJlZF9tZXRhbF9jb25jZW50cmF0aW9uID0gdmFsO1xuICAgIHRoaXMuX2ludHJhY2VsbHVsYXJfYXZhaWxhYmxlX2RlbHRhX0cgPSB0aGlzLmNhbGN1bGF0ZURlbHRhRyh0aGlzLl9idWZmZXJlZF9tZXRhbF9jb25jZW50cmF0aW9uKTtcbiAgfVxuXG4gIGdldCBpbnRyYWNlbGx1bGFyX2F2YWlsYWJsZV9kZWx0YV9HKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuX2ludHJhY2VsbHVsYXJfYXZhaWxhYmxlX2RlbHRhX0c7XG4gIH1cblxuICBzZXQgaW50cmFjZWxsdWxhcl9hdmFpbGFibGVfZGVsdGFfRyh2YWw6bnVtYmVyKSB7XG4gICAgaWYgKHZhbCA8PSAwKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIkludHJhY2VsbHVsYXIgYXZhaWxhYmxlIOKIhkcgbXVzdCBiZSA+IDBcIik7XG4gICAgdGhpcy5faW50cmFjZWxsdWxhcl9hdmFpbGFibGVfZGVsdGFfRyA9IHZhbDtcbiAgfVxuXG4gIGdldFByb3BlcnR5KGtleToga2V5b2YgTWV0YWwpIHtcbiAgICByZXR1cm4gdGhpc1trZXldO1xuICB9XG5cbn1cblxuY29uc3QgbWV0YWxfdmFsczogQXJyYXk8W3N0cmluZywgc3RyaW5nLCBudW1iZXIsIG51bWJlcl0+ID0gW1xuICBbXCJNYWduZXNpdW1cIiwgXCJNZ1wiLCAxRTMsIDIuN0UtM10sXG4gIFtcIk1hbmdhbmVzZVwiLCBcIk1uXCIsIDFFMywgMi42RS02XSxcbiAgW1wiSXJvblwiLCBcIkZlXCIsIDFFLTYsIDQuOEUtOF0sXG4gIFtcIkNvYmFsdFwiLCBcIkNvXCIsIDNFLTExLCAyLjVFLTldLFxuICBbXCJOaWNrZWxcIiwgXCJOaVwiLCA5LjhFLTEwLCAxLjhFLTEzXSxcbiAgW1wiQ29wcGVyXCIsIFwiQ3VcIiwgMi40RS0xNiwgMS4yRS0xOF0sXG4gIFtcIlppbmNcIiwgXCJablwiLCAxLjlFLTEzLCAxLjE5RS0xMl0sXG5dXG5cbmV4cG9ydCBjb25zdCBhbGxfbWV0YWxzOiB7IFtpZDogc3RyaW5nXTogTWV0YWw7IH0gPSB7fTtcblxuZm9yICh2YXIgbSBvZiBtZXRhbF92YWxzKSB7XG4gIGFsbF9tZXRhbHNbbVsxXS50b0xvd2VyQ2FzZSgpXSA9IG5ldyBNZXRhbCguLi5tKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZU9jY3VwYW5jeSgpIHtcbiAgdmFyIGV4cF9zY2FsZWRfZGlmZmVyZW5jZXM6IHsgW2lkOiBzdHJpbmddOiBudW1iZXI7IH0gPSB7fTtcbiAgdmFyIHRvdGFsX2RpZmZzOiBudW1iZXIgPSAwO1xuICBmb3IgKHZhciBpZCBpbiBhbGxfbWV0YWxzKSB7XG4gICAgY29uc3QgbSA9IGFsbF9tZXRhbHNbaWRdO1xuICAgIGV4cF9zY2FsZWRfZGlmZmVyZW5jZXNbaWRdID0gTWF0aC5leHAoXG4gICAgICAxMDAwICogKG0uaW50cmFjZWxsdWxhcl9hdmFpbGFibGVfZGVsdGFfRyAtIG0ubWV0YWxhdGlvbl9kZWx0YV9HKVxuICAgICAgLyAoOC4zMTQgKiAyOTguMTUpXG4gICAgKTtcbiAgICB0b3RhbF9kaWZmcyArPSBleHBfc2NhbGVkX2RpZmZlcmVuY2VzW2lkXTtcbiAgfVxuXG4gIHZhciBvY2N1cGFuY2llczogeyBbaWQ6IHN0cmluZ106IG51bWJlcjsgfSA9IHt9O1xuICB2YXIgdG90YWxfb2NjdXBhbmN5OiBudW1iZXIgPSAwO1xuXG4gIGZvciAodmFyIGlkIGluIGFsbF9tZXRhbHMpIHtcbiAgICBvY2N1cGFuY2llc1tpZF0gPSBleHBfc2NhbGVkX2RpZmZlcmVuY2VzW2lkXSAvICgxICsgdG90YWxfZGlmZnMpO1xuICAgIHRvdGFsX29jY3VwYW5jeSArPSBvY2N1cGFuY2llc1tpZF07XG4gIH1cbiAgb2NjdXBhbmNpZXNbJ3RvdGFsJ10gPSB0b3RhbF9vY2N1cGFuY3k7XG5cbiAgcmV0dXJuIG9jY3VwYW5jaWVzO1xufVxuIl19
