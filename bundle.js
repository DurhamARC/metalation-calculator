(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var metals = require("./metals");
function createMetalNumberInput(prefix, metal, metalPropertyName, additionalOnChange) {
    var input = document.createElement('input');
    input.value = metal.buffered_metal_concentration.toString();
    input.classList.add(prefix);
    input.id = prefix + '_' + metal.id_suffix;
    input.type = 'number';
    input.addEventListener('change', function (event) {
        var _a;
        var val = event.target.value;
        var floatVal = parseFloat(val); // TODO: validation!
        var m = metals.all_metals[metal.id_suffix];
        Object.assign(m, (_a = {}, _a[metalPropertyName] = floatVal, _a));
        if (additionalOnChange)
            additionalOnChange(metal.id_suffix);
    });
    return input;
}
function appendMetalTableRow(metal, table) {
    var row = table.insertRow(table.rows.length - 1);
    row.insertCell(-1).outerHTML = "<th>" + metal.symbol + "</th>";
    var affinity_cell = row.insertCell(-1);
    affinity_cell.classList.add('affinity');
    var affinity_input = createMetalNumberInput('affinity', metal, 'affinity', function (id) {
        var m = metals.all_metals[id];
        m.metalation_delta_G = m.calculateDeltaG(m.affinity);
        // FIXME: change this to be watched by Metal?
        document.getElementById("metalation_delta_g_" + id).innerText = m.metalation_delta_G.toFixed(1).toString();
    });
    affinity_cell.appendChild(affinity_input);
    var m_delta_g_cell = row.insertCell(-1);
    m_delta_g_cell.id = "metalation_delta_g_" + metal.id_suffix;
    m_delta_g_cell.innerText = metal.metalation_delta_G.toFixed(1).toString();
    var bmc_cell = row.insertCell(-1);
    bmc_cell.classList.add('bmc');
    var bmc_input = createMetalNumberInput('bmc', metal, 'buffered_metal_concentration', function (id) {
        var m = metals.all_metals[id];
        m.intracellular_available_delta_G = m.calculateDeltaG(m.buffered_metal_concentration);
        //FIXME: change this to be watched by Metal?
        document.getElementById("ia_delta_g_" + id).value = m.intracellular_available_delta_G.toString();
    });
    bmc_cell.appendChild(bmc_input);
    var ia_delta_g_cell = row.insertCell(-1);
    var ia_delta_g_input = createMetalNumberInput('ia_delta_g', metal, 'intracellular_available_delta_G', null);
    ia_delta_g_cell.appendChild(ia_delta_g_input);
    var result_cell = row.insertCell(-1);
    result_cell.id = "result_" + metal.id_suffix;
}
function calculate() {
    var results = metals.calculateOccupancy();
    for (var id in metals.all_metals) {
        var r = results[id];
        var result_cell = document.getElementById("result_" + id);
        result_cell.innerHTML = (r * 100).toFixed(2).toString() + '%';
    }
    var total_cell = document.getElementById("total_metalation");
    total_cell.innerHTML = (results['total'] * 100).toFixed(2).toString() + '%';
}
// Quick and simple export target #table_id into a csv
function downloadTableAsCsv(table_id, separator) {
    if (separator === void 0) { separator = ','; }
    // Select rows from table_id
    var rows = document.querySelectorAll('table#' + table_id + ' tr');
    // Construct csv
    var csv = [];
    for (var i = 0; i < rows.length; i++) {
        var row = [], cols = rows[i].querySelectorAll('td, th');
        for (var j = 0; j < cols.length; j++) {
            // Clean innertext to remove multiple spaces and jumpline (break csv)
            var data;
            var inputs = cols[j].getElementsByTagName('input');
            if (inputs.length > 0) {
                data = inputs[0].value;
            }
            else {
                data = cols[j].innerText;
            }
            // Remove line breaks and escape double-quote with double-double-quote
            data = data.replace(/(\r\n|\n|\r)/gm, '').replace(/(\s\s)/gm, ' ');
            data = data.replace(/"/g, '""');
            // Push escaped string
            row.push('"' + data + '"');
        }
        csv.push(row.join(separator));
    }
    var csv_string = csv.join('\n');
    // Download it
    var filename = 'export_' + table_id + '_' + new Date().toLocaleDateString() + '.csv';
    var link = document.createElement('a');
    link.style.display = 'none';
    link.setAttribute('target', '_blank');
    link.setAttribute('href', 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv_string));
    link.setAttribute('download', filename);
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}
window.addEventListener('DOMContentLoaded', function (event) {
    var metal_table = document.getElementById('metalation_table');
    for (var id in metals.all_metals) {
        var m = metals.all_metals[id];
        appendMetalTableRow(m, metal_table);
    }
    document.getElementById('calculate_btn').onclick = function () {
        calculate();
        document.getElementById('download_btn').disabled = false;
    };
    document.getElementById('download_btn').onclick = function () {
        downloadTableAsCsv('metalation_table');
    };
});

},{"./metals":2}],2:[function(require,module,exports){
"use strict";
var __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {
    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {
        if (ar || !(i in from)) {
            if (!ar) ar = Array.prototype.slice.call(from, 0, i);
            ar[i] = from[i];
        }
    }
    return to.concat(ar || Array.prototype.slice.call(from));
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.calculateOccupancy = exports.all_metals = exports.Metal = void 0;
var Metal = /** @class */ (function () {
    function Metal(name, symbol, affinity, concentration) {
        this.name = name;
        this.symbol = symbol;
        this.affinity = affinity;
        this.metalation_delta_G = this.calculateDeltaG(affinity);
        this.buffered_metal_concentration = concentration;
        this.intracellular_available_delta_G = this.calculateDeltaG(concentration);
        this.id_suffix = symbol.toLowerCase();
    }
    Metal.prototype.calculateDeltaG = function (mole_value) {
        return 8.314 * 298.15 * Math.log(mole_value) / 1000;
    };
    return Metal;
}());
exports.Metal = Metal;
var metal_vals = [
    ["Magnesium", "Mg", 1E3, 2.7E-3],
    ["Manganese", "Mn", 1E3, 2.6E-6],
    ["Iron", "Fe", 1E-6, 4.8E-8],
    ["Cobalt", "Co", 3E-11, 2.5E-9],
    ["Nickel", "Ni", 9.8E-10, 1.8E-13],
    ["Copper", "Cu", 2.4E-16, 1.2E-18],
    ["Zinc", "Zn", 1.9E-13, 1.19E-12],
];
exports.all_metals = {};
for (var _i = 0, metal_vals_1 = metal_vals; _i < metal_vals_1.length; _i++) {
    var m = metal_vals_1[_i];
    exports.all_metals[m[1].toLowerCase()] = new (Metal.bind.apply(Metal, __spreadArray([void 0], m, false)))();
}
function calculateOccupancy() {
    var exp_scaled_differences = {};
    var total_diffs = 0;
    for (var id in exports.all_metals) {
        var m_1 = exports.all_metals[id];
        exp_scaled_differences[id] = Math.exp(1000 * (m_1.intracellular_available_delta_G - m_1.metalation_delta_G)
            / (8.314 * 298.15));
        total_diffs += exp_scaled_differences[id];
    }
    var occupancies = {};
    var total_occupancy = 0;
    for (var id in exports.all_metals) {
        occupancies[id] = exp_scaled_differences[id] / (1 + total_diffs);
        total_occupancy += occupancies[id];
    }
    occupancies['total'] = total_occupancy;
    return occupancies;
}
exports.calculateOccupancy = calculateOccupancy;

},{}]},{},[1,2])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvbWFpbi50cyIsInNyYy9tZXRhbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7OztBQ0FBLGlDQUFrQztBQUVsQyxTQUFTLHNCQUFzQixDQUFDLE1BQWUsRUFBRSxLQUFvQixFQUFFLGlCQUF5QixFQUFFLGtCQUF3QztJQUN4SSxJQUFNLEtBQUssR0FBcUIsUUFBUSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUNoRSxLQUFLLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQyw0QkFBNEIsQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUM1RCxLQUFLLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUM1QixLQUFLLENBQUMsRUFBRSxHQUFHLE1BQU0sR0FBRyxHQUFHLEdBQUcsS0FBSyxDQUFDLFNBQVMsQ0FBQztJQUMxQyxLQUFLLENBQUMsSUFBSSxHQUFHLFFBQVEsQ0FBQztJQUN0QixLQUFLLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxFQUFFLFVBQVMsS0FBSzs7UUFDN0MsSUFBTSxHQUFHLEdBQXNCLEtBQUssQ0FBQyxNQUFPLENBQUMsS0FBSyxDQUFDO1FBQ25ELElBQUksUUFBUSxHQUFHLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLG9CQUFvQjtRQUNwRCxJQUFNLENBQUMsR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUM3QyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsWUFBSSxHQUFDLGlCQUFpQixJQUFHLFFBQVEsTUFBRyxDQUFDO1FBQ3BELElBQUksa0JBQWtCO1lBQUUsa0JBQWtCLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQzlELENBQUMsQ0FBQyxDQUFDO0lBQ0gsT0FBTyxLQUFLLENBQUM7QUFDZixDQUFDO0FBRUQsU0FBUyxtQkFBbUIsQ0FBQyxL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Y2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsImltcG9ydCAqIGFzIG1ldGFscyBmcm9tIFwiLi9tZXRhbHNcIlxuXG5mdW5jdGlvbiBjcmVhdGVNZXRhbE51bWJlcklucHV0KHByZWZpeCA6IHN0cmluZywgbWV0YWwgOiBtZXRhbHMuTWV0YWwsIG1ldGFsUHJvcGVydHlOYW1lOiBzdHJpbmcsIGFkZGl0aW9uYWxPbkNoYW5nZTogKGlkOiBzdHJpbmcpID0+IHZvaWQpIHtcbiAgY29uc3QgaW5wdXQgPSA8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICBpbnB1dC52YWx1ZSA9IG1ldGFsLmJ1ZmZlcmVkX21ldGFsX2NvbmNlbnRyYXRpb24udG9TdHJpbmcoKTtcbiAgaW5wdXQuY2xhc3NMaXN0LmFkZChwcmVmaXgpO1xuICBpbnB1dC5pZCA9IHByZWZpeCArICdfJyArIG1ldGFsLmlkX3N1ZmZpeDtcbiAgaW5wdXQudHlwZSA9ICdudW1iZXInO1xuICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmdW5jdGlvbihldmVudCkge1xuICAgIGNvbnN0IHZhbCA9ICg8SFRNTElucHV0RWxlbWVudD5ldmVudC50YXJnZXQpLnZhbHVlO1xuICAgIHZhciBmbG9hdFZhbCA9IHBhcnNlRmxvYXQodmFsKTsgLy8gVE9ETzogdmFsaWRhdGlvbiFcbiAgICBjb25zdCBtID0gbWV0YWxzLmFsbF9tZXRhbHNbbWV0YWwuaWRfc3VmZml4XTtcbiAgICBPYmplY3QuYXNzaWduKG0sIHsgW21ldGFsUHJvcGVydHlOYW1lXTogZmxvYXRWYWwgfSk7XG4gICAgaWYgKGFkZGl0aW9uYWxPbkNoYW5nZSkgYWRkaXRpb25hbE9uQ2hhbmdlKG1ldGFsLmlkX3N1ZmZpeCk7XG4gIH0pO1xuICByZXR1cm4gaW5wdXQ7XG59XG5cbmZ1bmN0aW9uIGFwcGVuZE1ldGFsVGFibGVSb3cobWV0YWw6IG1ldGFscy5NZXRhbCwgdGFibGU6IEhUTUxUYWJsZUVsZW1lbnQpIHtcbiAgY29uc3Qgcm93OiBIVE1MVGFibGVSb3dFbGVtZW50ID0gdGFibGUuaW5zZXJ0Um93KHRhYmxlLnJvd3MubGVuZ3RoLTEpO1xuXG4gIHJvdy5pbnNlcnRDZWxsKC0xKS5vdXRlckhUTUwgPSBcIjx0aD5cIiArIG1ldGFsLnN5bWJvbCArIFwiPC90aD5cIjtcblxuICBjb25zdCBhZmZpbml0eV9jZWxsOiBIVE1MVGFibGVDZWxsRWxlbWVudCA9IHJvdy5pbnNlcnRDZWxsKC0xKTtcbiAgYWZmaW5pdHlfY2VsbC5jbGFzc0xpc3QuYWRkKCdhZmZpbml0eScpO1xuICBjb25zdCBhZmZpbml0eV9pbnB1dCA9IGNyZWF0ZU1ldGFsTnVtYmVySW5wdXQoJ2FmZmluaXR5JywgbWV0YWwsICdhZmZpbml0eScsIGZ1bmN0aW9uKGlkKSB7XG4gICAgY29uc3QgbSA9IG1ldGFscy5hbGxfbWV0YWxzW2lkXTtcbiAgICBtLm1ldGFsYXRpb25fZGVsdGFfRyA9IG0uY2FsY3VsYXRlRGVsdGFHKG0uYWZmaW5pdHkpO1xuICAgIC8vIEZJWE1FOiBjaGFuZ2UgdGhpcyB0byBiZSB3YXRjaGVkIGJ5IE1ldGFsP1xuICAgICg8SFRNTFRhYmxlQ2VsbEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtZXRhbGF0aW9uX2RlbHRhX2dfXCIgKyBpZCkpLmlubmVyVGV4dCA9IG0ubWV0YWxhdGlvbl9kZWx0YV9HLnRvRml4ZWQoMSkudG9TdHJpbmcoKTtcbiAgfSk7XG4gIGFmZmluaXR5X2NlbGwuYXBwZW5kQ2hpbGQoYWZmaW5pdHlfaW5wdXQpO1xuXG4gIGNvbnN0IG1fZGVsdGFfZ19jZWxsOiBIVE1MVGFibGVDZWxsRWxlbWVudCA9IHJvdy5pbnNlcnRDZWxsKC0xKTtcbiAgbV9kZWx0YV9nX2NlbGwuaWQgPSBcIm1ldGFsYXRpb25fZGVsdGFfZ19cIiArIG1ldGFsLmlkX3N1ZmZpeDtcbiAgbV9kZWx0YV9nX2NlbGwuaW5uZXJUZXh0ID0gbWV0YWwubWV0YWxhdGlvbl9kZWx0YV9HLnRvRml4ZWQoMSkudG9TdHJpbmcoKTtcblxuICBjb25zdCBibWNfY2VsbDogSFRNTFRhYmxlQ2VsbEVsZW1lbnQgPSByb3cuaW5zZXJ0Q2VsbCgtMSk7XG4gIGJtY19jZWxsLmNsYXNzTGlzdC5hZGQoJ2JtYycpO1xuICBjb25zdCBibWNfaW5wdXQgPSBjcmVhdGVNZXRhbE51bWJlcklucHV0KCdibWMnLCBtZXRhbCwgJ2J1ZmZlcmVkX21ldGFsX2NvbmNlbnRyYXRpb24nLCBmdW5jdGlvbihpZCkge1xuICAgIGNvbnN0IG0gPSBtZXRhbHMuYWxsX21ldGFsc1tpZF07XG4gICAgbS5pbnRyYWNlbGx1bGFyX2F2YWlsYWJsZV9kZWx0YV9HID0gbS5jYWxjdWxhdGVEZWx0YUcobS5idWZmZXJlZF9tZXRhbF9jb25jZW50cmF0aW9uKTtcbiAgICAvL0ZJWE1FOiBjaGFuZ2UgdGhpcyB0byBiZSB3YXRjaGVkIGJ5IE1ldGFsP1xuICAgICg8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImlhX2RlbHRhX2dfXCIgKyBpZCkpLnZhbHVlID0gbS5pbnRyYWNlbGx1bGFyX2F2YWlsYWJsZV9kZWx0YV9HLnRvU3RyaW5nKCk7XG4gIH0pXG5cbiAgYm1jX2NlbGwuYXBwZW5kQ2hpbGQoYm1jX2lucHV0KTtcblxuICBjb25zdCBpYV9kZWx0YV9nX2NlbGw6IEhUTUxUYWJsZUNlbGxFbGVtZW50ID0gcm93Lmluc2VydENlbGwoLTEpO1xuICBjb25zdCBpYV9kZWx0YV9nX2lucHV0ID0gY3JlYXRlTWV0YWxOdW1iZXJJbnB1dCgnaWFfZGVsdGFfZycsIG1ldGFsLCAnaW50cmFjZWxsdWxhcl9hdmFpbGFibGVfZGVsdGFfRycsIG51bGwpO1xuICBpYV9kZWx0YV9nX2NlbGwuYXBwZW5kQ2hpbGQoaWFfZGVsdGFfZ19pbnB1dCk7XG5cbiAgY29uc3QgcmVzdWx0X2NlbGw6IEhUTUxUYWJsZUNlbGxFbGVtZW50ID0gcm93Lmluc2VydENlbGwoLTEpO1xuICByZXN1bHRfY2VsbC5pZCA9IFwicmVzdWx0X1wiICsgbWV0YWwuaWRfc3VmZml4O1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGUoKSB7XG4gIGNvbnN0IHJlc3VsdHMgPSBtZXRhbHMuY2FsY3VsYXRlT2NjdXBhbmN5KCk7XG5cbiAgZm9yICh2YXIgaWQgaW4gbWV0YWxzLmFsbF9tZXRhbHMpIHtcbiAgICBjb25zdCByID0gcmVzdWx0c1tpZF07XG4gICAgY29uc3QgcmVzdWx0X2NlbGwgPSA8SFRNTFRhYmxlQ2VsbEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXN1bHRfXCIgKyBpZCk7XG4gICAgcmVzdWx0X2NlbGwuaW5uZXJIVE1MID0gKHIgKiAxMDApLnRvRml4ZWQoMikudG9TdHJpbmcoKSArICclJztcbiAgfVxuXG4gIGNvbnN0IHRvdGFsX2NlbGwgPSA8SFRNTFRhYmxlQ2VsbEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ0b3RhbF9tZXRhbGF0aW9uXCIpO1xuICB0b3RhbF9jZWxsLmlubmVySFRNTCA9IChyZXN1bHRzWyd0b3RhbCddICogMTAwKS50b0ZpeGVkKDIpLnRvU3RyaW5nKCkgKyAnJSc7XG59XG5cbi8vIFF1aWNrIGFuZCBzaW1wbGUgZXhwb3J0IHRhcmdldCAjdGFibGVfaWQgaW50byBhIGNzdlxuZnVuY3Rpb24gZG93bmxvYWRUYWJsZUFzQ3N2KHRhYmxlX2lkOiBzdHJpbmcsIHNlcGFyYXRvcjogc3RyaW5nID0gJywnKSB7XG4gICAgLy8gU2VsZWN0IHJvd3MgZnJvbSB0YWJsZV9pZFxuICAgIHZhciByb3dzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgndGFibGUjJyArIHRhYmxlX2lkICsgJyB0cicpO1xuICAgIC8vIENvbnN0cnVjdCBjc3ZcbiAgICB2YXIgY3N2ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCByb3dzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciByb3cgPSBbXSwgY29scyA9IDxOb2RlTGlzdE9mPEhUTUxUYWJsZUNlbGxFbGVtZW50Pj5yb3dzW2ldLnF1ZXJ5U2VsZWN0b3JBbGwoJ3RkLCB0aCcpO1xuICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGNvbHMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgIC8vIENsZWFuIGlubmVydGV4dCB0byByZW1vdmUgbXVsdGlwbGUgc3BhY2VzIGFuZCBqdW1wbGluZSAoYnJlYWsgY3N2KVxuICAgICAgICAgICAgdmFyIGRhdGE7XG4gICAgICAgICAgICBjb25zdCBpbnB1dHMgPSBjb2xzW2pdLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdpbnB1dCcpO1xuICAgICAgICAgICAgaWYgKGlucHV0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgIGRhdGEgPSBpbnB1dHNbMF0udmFsdWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBkYXRhID0gY29sc1tqXS5pbm5lclRleHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBSZW1vdmUgbGluZSBicmVha3MgYW5kIGVzY2FwZSBkb3VibGUtcXVvdGUgd2l0aCBkb3VibGUtZG91YmxlLXF1b3RlXG4gICAgICAgICAgICBkYXRhID0gZGF0YS5yZXBsYWNlKC8oXFxyXFxufFxcbnxcXHIpL2dtLCAnJykucmVwbGFjZSgvKFxcc1xccykvZ20sICcgJyk7XG4gICAgICAgICAgICBkYXRhID0gZGF0YS5yZXBsYWNlKC9cIi9nLCAnXCJcIicpO1xuICAgICAgICAgICAgLy8gUHVzaCBlc2NhcGVkIHN0cmluZ1xuICAgICAgICAgICAgcm93LnB1c2goJ1wiJyArIGRhdGEgKyAnXCInKTtcbiAgICAgICAgfVxuICAgICAgICBjc3YucHVzaChyb3cuam9pbihzZXBhcmF0b3IpKTtcbiAgICB9XG4gICAgdmFyIGNzdl9zdHJpbmcgPSBjc3Yuam9pbignXFxuJyk7XG4gICAgLy8gRG93bmxvYWQgaXRcbiAgICB2YXIgZmlsZW5hbWUgPSAnZXhwb3J0XycgKyB0YWJsZV9pZCArICdfJyArIG5ldyBEYXRlKCkudG9Mb2NhbGVEYXRlU3RyaW5nKCkgKyAnLmNzdic7XG4gICAgdmFyIGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XG4gICAgbGluay5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgIGxpbmsuc2V0QXR0cmlidXRlKCd0YXJnZXQnLCAnX2JsYW5rJyk7XG4gICAgbGluay5zZXRBdHRyaWJ1dGUoJ2hyZWYnLCAnZGF0YTp0ZXh0L2NzdjtjaGFyc2V0PXV0Zi04LCcgKyBlbmNvZGVVUklDb21wb25lbnQoY3N2X3N0cmluZykpO1xuICAgIGxpbmsuc2V0QXR0cmlidXRlKCdkb3dubG9hZCcsIGZpbGVuYW1lKTtcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmspO1xuICAgIGxpbmsuY2xpY2soKTtcbiAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGxpbmspO1xufVxuXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIChldmVudCkgPT4ge1xuICBjb25zdCBtZXRhbF90YWJsZSA9IDxIVE1MVGFibGVFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhbGF0aW9uX3RhYmxlJyk7XG4gIGZvciAodmFyIGlkIGluIG1ldGFscy5hbGxfbWV0YWxzKSB7XG4gICAgY29uc3QgbSA9IG1ldGFscy5hbGxfbWV0YWxzW2lkXTtcbiAgICBhcHBlbmRNZXRhbFRhYmxlUm93KG0sIG1ldGFsX3RhYmxlKTtcbiAgfVxuXG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYWxjdWxhdGVfYnRuJykub25jbGljayA9IGZ1bmN0aW9uKCkge1xuICAgIGNhbGN1bGF0ZSgpO1xuICAgICg8SFRNTEJ1dHRvbkVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rvd25sb2FkX2J0bicpKS5kaXNhYmxlZCA9IGZhbHNlO1xuICB9O1xuXG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkb3dubG9hZF9idG4nKS5vbmNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgZG93bmxvYWRUYWJsZUFzQ3N2KCdtZXRhbGF0aW9uX3RhYmxlJyk7XG4gIH07XG59KTtcbiIsImV4cG9ydCBjbGFzcyBNZXRhbCB7XG4gIG5hbWU6IHN0cmluZztcbiAgc3ltYm9sOiBzdHJpbmc7XG4gIGFmZmluaXR5OiBudW1iZXI7XG4gIG1ldGFsYXRpb25fZGVsdGFfRzogbnVtYmVyO1xuICBidWZmZXJlZF9tZXRhbF9jb25jZW50cmF0aW9uOiBudW1iZXI7XG4gIGludHJhY2VsbHVsYXJfYXZhaWxhYmxlX2RlbHRhX0c6IG51bWJlcjtcbiAgaWRfc3VmZml4OiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IobmFtZTpzdHJpbmcsIHN5bWJvbDpzdHJpbmcsIGFmZmluaXR5Om51bWJlciwgY29uY2VudHJhdGlvbjpudW1iZXIpIHtcbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgIHRoaXMuc3ltYm9sID0gc3ltYm9sO1xuICAgIHRoaXMuYWZmaW5pdHkgPSBhZmZpbml0eTtcbiAgICB0aGlzLm1ldGFsYXRpb25fZGVsdGFfRyA9IHRoaXMuY2FsY3VsYXRlRGVsdGFHKGFmZmluaXR5KTtcbiAgICB0aGlzLmJ1ZmZlcmVkX21ldGFsX2NvbmNlbnRyYXRpb24gPSBjb25jZW50cmF0aW9uO1xuICAgIHRoaXMuaW50cmFjZWxsdWxhcl9hdmFpbGFibGVfZGVsdGFfRyA9IHRoaXMuY2FsY3VsYXRlRGVsdGFHKGNvbmNlbnRyYXRpb24pO1xuICAgIHRoaXMuaWRfc3VmZml4ID0gc3ltYm9sLnRvTG93ZXJDYXNlKCk7XG4gIH1cblxuICBjYWxjdWxhdGVEZWx0YUcobW9sZV92YWx1ZTogbnVtYmVyKTogbnVtYmVyIHtcbiAgICByZXR1cm4gOC4zMTQgKiAyOTguMTUgKiBNYXRoLmxvZyhtb2xlX3ZhbHVlKSAvIDEwMDA7XG4gIH1cbn1cblxuY29uc3QgbWV0YWxfdmFsczogQXJyYXk8W3N0cmluZywgc3RyaW5nLCBudW1iZXIsIG51bWJlcl0+ID0gW1xuICBbXCJNYWduZXNpdW1cIiwgXCJNZ1wiLCAxRTMsIDIuN0UtM10sXG4gIFtcIk1hbmdhbmVzZVwiLCBcIk1uXCIsIDFFMywgMi42RS02XSxcbiAgW1wiSXJvblwiLCBcIkZlXCIsIDFFLTYsIDQuOEUtOF0sXG4gIFtcIkNvYmFsdFwiLCBcIkNvXCIsIDNFLTExLCAyLjVFLTldLFxuICBbXCJOaWNrZWxcIiwgXCJOaVwiLCA5LjhFLTEwLCAxLjhFLTEzXSxcbiAgW1wiQ29wcGVyXCIsIFwiQ3VcIiwgMi40RS0xNiwgMS4yRS0xOF0sXG4gIFtcIlppbmNcIiwgXCJablwiLCAxLjlFLTEzLCAxLjE5RS0xMl0sXG5dXG5cbmV4cG9ydCBjb25zdCBhbGxfbWV0YWxzOiB7IFtpZDogc3RyaW5nXTogTWV0YWw7IH0gPSB7fTtcblxuZm9yICh2YXIgbSBvZiBtZXRhbF92YWxzKSB7XG4gIGFsbF9tZXRhbHNbbVsxXS50b0xvd2VyQ2FzZSgpXSA9IG5ldyBNZXRhbCguLi5tKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZU9jY3VwYW5jeSgpIHtcbiAgdmFyIGV4cF9zY2FsZWRfZGlmZmVyZW5jZXM6IHsgW2lkOiBzdHJpbmddOiBudW1iZXI7IH0gPSB7fTtcbiAgdmFyIHRvdGFsX2RpZmZzOiBudW1iZXIgPSAwO1xuICBmb3IgKHZhciBpZCBpbiBhbGxfbWV0YWxzKSB7XG4gICAgY29uc3QgbSA9IGFsbF9tZXRhbHNbaWRdO1xuICAgIGV4cF9zY2FsZWRfZGlmZmVyZW5jZXNbaWRdID0gTWF0aC5leHAoXG4gICAgICAxMDAwICogKG0uaW50cmFjZWxsdWxhcl9hdmFpbGFibGVfZGVsdGFfRyAtIG0ubWV0YWxhdGlvbl9kZWx0YV9HKVxuICAgICAgLyAoOC4zMTQgKiAyOTguMTUpXG4gICAgKTtcbiAgICB0b3RhbF9kaWZmcyArPSBleHBfc2NhbGVkX2RpZmZlcmVuY2VzW2lkXTtcbiAgfVxuXG4gIHZhciBvY2N1cGFuY2llczogeyBbaWQ6IHN0cmluZ106IG51bWJlcjsgfSA9IHt9O1xuICB2YXIgdG90YWxfb2NjdXBhbmN5OiBudW1iZXIgPSAwO1xuXG4gIGZvciAodmFyIGlkIGluIGFsbF9tZXRhbHMpIHtcbiAgICBvY2N1cGFuY2llc1tpZF0gPSBleHBfc2NhbGVkX2RpZmZlcmVuY2VzW2lkXSAvICgxICsgdG90YWxfZGlmZnMpO1xuICAgIHRvdGFsX29jY3VwYW5jeSArPSBvY2N1cGFuY2llc1tpZF07XG4gIH1cbiAgb2NjdXBhbmNpZXNbJ3RvdGFsJ10gPSB0b3RhbF9vY2N1cGFuY3k7XG5cbiAgcmV0dXJuIG9jY3VwYW5jaWVzO1xufVxuIl19
